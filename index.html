<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Solicitud de Certificado</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@0.9.4/css/bulma.min.css">
</head>
<body>

<section class="section">
  <div class="container" style="max-width: 600px;">
    <h1 class="title">Solicitud de Certificado</h1>

    <!-- EMAIL -->
    <div class="field">
      <label class="label">Correo electrónico</label>
      <div class="control">
        <input
          class="input"
          type="email"
          id="email"
          placeholder="tu@correo.com"
          required
        >
      </div>
    </div>

    <!-- BOTÓN -->
    <div class="field">
      <button class="button is-primary" onclick="buscarCursos()">
        Buscar mis programas
      </button>
    </div>

    <!-- MENSAJE -->
    <p id="estado" class="has-text-grey mb-3"></p>

    <!-- SELECT -->
    <div class="field" id="bloqueCursos" style="display:none;">
      <label class="label">Programas inscritos</label>
      <div class="control">
        <div class="select is-fullwidth">
          <select id="listaCursos"></select>
        </div>
      </div>
    </div>
  </div>
</section>

<script>
const WEBHOOK_URL = "https://hook.us2.make.com/a8ja8l2g1oo7qsrjr5xqo3n4bacj8bf3";

async function buscarCursos() {
  const email = document.getElementById("email").value.trim();
  const estado = document.getElementById("estado");
  const select = document.getElementById("listaCursos");
  const bloque = document.getElementById("bloqueCursos");

  if (!email) {
    alert("Ingresa un correo válido");
    return;
  }

  estado.textContent = "Buscando programas...";
  bloque.style.display = "none";
  select.innerHTML = "";

  try {
    const response = await fetch(WEBHOOK_URL, {
      method: "POST",
      headers: {
        "Content-Type": "application/json"
      },
      body: JSON.stringify({ email: email })
    });

    if (!response.ok) {
      throw new Error("Error HTTP");
    }

    const cursos = await response.json();

    if (!Array.isArray(cursos) || cursos.length === 0) {
      estado.textContent = "No se encontraron programas asociados a este correo.";
      return;
    }

    cursos.forEach(curso => {
      const option = document.createElement("option");
      option.value = curso;
      option.textContent = curso;
      select.appendChild(option);
    });

    bloque.style.display = "block";
    estado.textContent = "Selecciona el programa para solicitar tu certificado.";

  } catch (error) {
    console.error(error);
    estado.textContent = "Error al obtener los programas. Intenta nuevamente.";
  }
}
</script>

</body>
</html>
