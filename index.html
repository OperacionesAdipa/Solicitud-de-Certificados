<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Solicitud de Certificado</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f5f5f5;
      padding: 40px;
    }

    .box {
      max-width: 420px;
      margin: auto;
      background: white;
      padding: 25px;
      border-radius: 8px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }

    label {
      display: block;
      margin-top: 15px;
      font-weight: bold;
    }

    input, select, button {
      width: 100%;
      padding: 10px;
      margin-top: 6px;
      font-size: 14px;
    }

    button {
      margin-top: 20px;
      background: #4f46e5;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
    }

    button:disabled {
      background: #9ca3af;
      cursor: not-allowed;
    }

    .loading {
      font-size: 13px;
      color: #555;
      margin-top: 10px;
    }
  </style>
</head>

<body>

  <div class="box">
    <h2>Solicitud de Certificado</h2>

    <!-- NO usamos <form> para evitar submit autom√°tico -->

    <label for="email">Correo electr√≥nico</label>
    <input
      type="email"
      id="email"
      placeholder="correo@ejemplo.com"
      required
    />

    <button type="button" onclick="buscarCursos()" id="btnBuscar">
      Buscar mis programas
    </button>

    <div id="estado" class="loading"></div>

    <label for="courses">Programas inscritos</label>
    <select id="courses" disabled>
      <option>Ingresa tu correo</option>
    </select>
  </div>

  <script>
    // üî¥ PEGA AQU√ç TU WEBHOOK DE MAKE
    const WEBHOOK_URL = "https://hook.us2.make.com/a8ja8l2g1oo7qsrjr5xqo3n4bacj8bf3";

    async function buscarCursos() {
      const email = document.getElementById("email").value.trim();
      const select = document.getElementById("courses");
      const estado = document.getElementById("estado");
      const boton = document.getElementById("btnBuscar");

      if (!email) {
        alert("Por favor ingresa tu correo");
        return;
      }

      // UI loading
      select.innerHTML = "<option>Cargando programas...</option>";
      select.disabled = true;
      estado.textContent = "Buscando tus programas, por favor espera‚Ä¶";
      boton.disabled = true;

      try {
        const response = await fetch(WEBHOOK_URL, {
          method: "POST",
          headers: {
            "Content-Type": "application/json"
          },
          body: JSON.stringify({ email })
        });

        const rawText = await response.text();
        console.log("RESPUESTA CRUDA:", rawText);

        if (!rawText) {
          throw new Error("Respuesta vac√≠a del servidor");
        }

        const data = JSON.parse(rawText);
        console.log("JSON PARSEADO:", data);

        select.innerHTML = "";

        if (!data.courses || data.courses.length === 0) {
          select.innerHTML = "<option>No se encontraron programas</option>";
          estado.textContent = "";
          boton.disabled = false;
          return;
        }

        data.courses.forEach(course => {
          const option = document.createElement("option");
          option.value = course.fullname;
          option.textContent = course.fullname;
          select.appendChild(option);
        });

        select.disabled = false;
        estado.textContent = "";

      } catch (error) {
        console.error(error);
        select.innerHTML = "<option>Error al cargar programas</option>";
        estado.textContent = "Ocurri√≥ un error. Intenta nuevamente.";
      } finally {
        boton.disabled = false;
      }
    }
  </script>

</body>
</html>
