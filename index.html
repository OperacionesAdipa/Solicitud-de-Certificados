<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Consulta de Cursos</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
</head>
<body style="background-color:red;">
<h1>PRUEBA NUEVA VERSION</h1>


<h2>Consulta de Cursos</h2>

<label>Correo electrónico</label><br>
<input type="email" id="email" placeholder="correo@ejemplo.com">
<br><br>

<button onclick="buscarCursos()">Buscar mis programas</button>

<br><br>

<label>Cursos inscritos</label><br>
<select id="cursos">
  <option>—</option>
</select>

<script>
const WEBHOOK_MAKE = "https://hook.us2.make.com/a8ja8l2g1oo7qsrjr5xqo3n4bacj8bf3";

async function buscarCursos() {
  const email = document.getElementById("email").value.trim();
  const select = document.getElementById("courses");

  select.innerHTML = "<option>Cargando...</option>";

  try {
    const response = await fetch(webhookUrl, {
      method: "POST",
      headers: {
        "Content-Type": "application/json"
      },
      body: JSON.stringify({ email })
    });

    const rawText = await response.text();

    console.log("⬇ RESPUESTA CRUDA DEL WEBHOOK ⬇");
    console.log(rawText);

    if (!rawText) {
      select.innerHTML = "<option>Respuesta vacía</option>";
      return;
    }

    let data;
    try {
      data = JSON.parse(rawText);
    } catch (e) {
      console.error("❌ Error parseando JSON", e);
      select.innerHTML = "<option>Error de formato</option>";
      return;
    }

    console.log("✅ JSON PARSEADO", data);

    select.innerHTML = "";

    if (!data.courses || data.courses.length === 0) {
      select.innerHTML = "<option>No se encontraron cursos</option>";
      return;
    }

    data.courses.forEach(curso => {
      const opt = document.createElement("option");
      opt.value = curso.fullname;
      opt.textContent = curso.fullname;
      select.appendChild(opt);
    });

  } catch (error) {
    console.error("❌ Error fetch", error);
    select.innerHTML = "<option>Error de conexión</option>";
  }
}
</script>

</body>
</html>
